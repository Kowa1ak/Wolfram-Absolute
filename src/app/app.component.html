<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css2?family=KoHo:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
  rel="stylesheet"
/>
<router-outlet> </router-outlet>

<button
  class="chat-button"
  [ngClass]="{ open: isChatOpen }"
  (click)="toggleChat($event)"
  *ngIf="!isLoginPage()"
>
  <mat-icon>{{
    isChatOpen ? "keyboard_arrow_right" : "keyboard_arrow_left"
  }}</mat-icon>
  <span *ngIf="!isChatOpen">CHAT</span>
</button>

<div
  #chatPanel
  class="chat-panel"
  [ngClass]="{ open: isChatOpen }"
  *ngIf="!isLoginPage()"
>
  <ng-container *ngIf="isUserLoggedIn(); else guest">
    <div class="user-content">
      <h1>CHAT</h1>
      <div class="account-option">
        <div class="account-info">
          <img src="/assets/img/man-shape.png" alt="" />
          <p>{{ getUsername() | async }}</p>
        </div>
        <button
          *ngIf="username"
          mat-icon-button
          class="exit-button"
          (click)="disconnect(); $event.stopPropagation()"
        >
          <mat-icon>exit_to_app</mat-icon>
        </button>
      </div>
      <div id="username-page" *ngIf="!username">
        <form id="usernameForm" (submit)="connect(); $event.preventDefault()">
          <button type="submit" class="start-button">Start chatting</button>
        </form>
      </div>

      <div id="chat-page" *ngIf="stompClient">
        <div class="connecting" *ngIf="!stompClient.connected">
          Connecting...
        </div>

        <ul id="messageArea">
          <li
            *ngFor="let message of messages"
            [class.event-message]="message.type !== 'CHAT'"
            [class.chat-message]="message.type === 'CHAT'"
          >
            <span *ngIf="message.type === 'CHAT'">{{ message.sender }}</span>
            <p>{{ message.content }}</p>
          </li>
        </ul>

        <form id="messageForm" (submit)="sendMessage($event)">
          <input
            name="messageInput"
            type="text"
            id="message"
            [(ngModel)]="messageInput"
            placeholder="Type a message..."
            (input)="handleInput($event)"
            required
          />
          <button type="submit">Send</button>
        </form>
      </div>
    </div>
  </ng-container>
  <ng-template #guest>
    <div class="guest-content">
      <h1 class="form-title">CHAT NOW</h1>
      <div class="buttonsAuth">
        <button class="large-button" routerLink="/login">Login</button>
        <button class="large-button" routerLink="/register">Register</button>
      </div>
    </div>
  </ng-template>
</div>
